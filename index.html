<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#FF4500">
    <title>Hot Wheels Collection</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Righteous&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --flame-orange: #FF4500;
            --racing-red: #E01E37;
            --speed-yellow: #FFD700;
            --chrome-silver: #C0C0C0;
            --track-gray: #2A2A2A;
            --asphalt: #1A1A1A;
            --white: #FFFFFF;
            --treasure-hunt-green: #2ECC71;
            --super-th-silver: #BDC3C7;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'DM Sans', sans-serif;
            background: linear-gradient(135deg, var(--asphalt) 0%, var(--track-gray) 100%);
            min-height: 100vh;
            color: var(--white);
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255, 255, 255, 0.03) 2px, rgba(255, 255, 255, 0.03) 4px);
            pointer-events: none;
            z-index: 1;
        }
        
        .app-container {
            position: relative;
            z-index: 2;
        }
        
        header {
            background: linear-gradient(90deg, var(--racing-red) 0%, var(--flame-orange) 100%);
            padding: 2rem 2rem 3rem;
            box-shadow: 0 10px 40px rgba(255, 69, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -50%;
            width: 200%;
            height: 100%;
            background: repeating-linear-gradient(45deg, transparent, transparent 20px, rgba(255, 255, 255, 0.05) 20px, rgba(255, 255, 255, 0.05) 40px);
            animation: slideStripes 20s linear infinite;
        }
        
        @keyframes slideStripes {
            0% { transform: translateX(0); }
            100% { transform: translateX(40px); }
        }
        
        h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 4.5rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            text-align: center;
            margin-bottom: 0.5rem;
            position: relative;
            text-shadow: 3px 3px 0px rgba(0, 0, 0, 0.4), 6px 6px 0px rgba(0, 0, 0, 0.2);
        }
        
        .tagline {
            text-align: center;
            font-size: 1.1rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            opacity: 0.95;
            position: relative;
            font-weight: 500;
        }

        .tab-navigation {
            display: flex;
            gap: 1rem;
            padding: 0 2rem;
            margin-top: -1.5rem;
            margin-bottom: 2rem;
            position: relative;
            z-index: 10;
            flex-wrap: wrap;
        }

        .tab-button {
            font-family: 'Righteous', sans-serif;
            padding: 1rem 2rem;
            background: rgba(26, 26, 26, 0.6);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px 12px 0 0;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .tab-button:hover {
            border-color: var(--flame-orange);
            background: rgba(42, 42, 42, 0.8);
        }

        .tab-button.active {
            background: linear-gradient(135deg, var(--flame-orange) 0%, var(--racing-red) 100%);
            border-color: transparent;
            box-shadow: 0 -5px 20px rgba(255, 69, 0, 0.3);
        }
        
        .section-container {
            background: rgba(42, 42, 42, 0.6);
            backdrop-filter: blur(10px);
            padding: 2rem;
            margin: 0 2rem 2rem;
            border-radius: 20px;
            border: 2px solid rgba(255, 69, 0, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-family: 'Righteous', sans-serif;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--speed-yellow);
        }
        
        input, select, textarea {
            background: rgba(26, 26, 26, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: var(--white);
            padding: 0.8rem;
            border-radius: 8px;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--flame-orange);
            box-shadow: 0 0 0 3px rgba(255, 69, 0, 0.2);
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }

        input[type="color"] {
            width: 100%;
            height: 50px;
            cursor: pointer;
        }
        
        .image-upload-multi {
            border: 3px dashed rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            background: rgba(26, 26, 26, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .image-upload-multi:hover {
            border-color: var(--flame-orange);
            background: rgba(255, 69, 0, 0.1);
        }

        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .image-gallery-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .image-gallery-item:hover {
            transform: scale(1.05);
        }

        .image-gallery-item.main-image {
            border-color: var(--speed-yellow);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }

        .image-gallery-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            display: block;
        }

        .image-gallery-item .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--racing-red);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-gallery-item .main-badge {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--speed-yellow);
            color: var(--asphalt);
            padding: 0.2rem;
            font-size: 0.7rem;
            font-weight: bold;
            text-align: center;
        }
        
        .btn {
            font-family: 'Righteous', sans-serif;
            background: linear-gradient(135deg, var(--flame-orange) 0%, var(--racing-red) 100%);
            color: var(--white);
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 12px;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(255, 69, 0, 0.4);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 69, 0, 0.6);
        }
        
        .search-filter-section {
            padding: 0 2rem;
            margin-bottom: 2rem;
        }
        
        .search-bar {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .search-bar input,
        .search-bar select {
            flex: 1;
            min-width: 200px;
        }
        
        .collection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
            padding: 0 2rem 4rem;
        }
        
        .car-card {
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border: 3px solid transparent;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }
        
        .car-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
        }
        
        /* REMOVED: Default gradient border at top of cards */

        .treasure-hunt-badge {
            position: absolute;
            top: 1rem;
            left: 1rem;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .treasure-hunt-badge.mainline {
            background: var(--flame-orange);
            color: white;
        }

        .treasure-hunt-badge.th {
            background: var(--treasure-hunt-green);
            color: white;
        }

        .treasure-hunt-badge.sth {
            background: linear-gradient(135deg, #C0C0C0 0%, #E8E8E8 50%, #C0C0C0 100%);
            color: var(--asphalt);
            font-weight: 900;
        }

        .owned-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--speed-yellow);
            color: var(--asphalt);
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            z-index: 10;
        }
        
        .car-image-container {
            position: relative;
            height: 240px;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0.6) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .image-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 5;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-nav.prev { left: 10px; }
        .image-nav.next { right: 10px; }

        .image-nav:hover {
            background: rgba(255, 69, 0, 0.8);
        }

        .image-indicator {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 5px;
            z-index: 5;
        }

        .image-indicator-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }

        .image-indicator-dot.active {
            background: white;
            transform: scale(1.3);
        }
        
        .car-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.5));
        }
        
        .car-info {
            padding: 1.5rem;
        }
        
        .car-name {
            font-family: 'Righteous', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--speed-yellow);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .car-series {
            font-size: 0.9rem;
            color: var(--chrome-silver);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
            font-weight: 500;
        }
        
        .car-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.8rem;
            margin-bottom: 1rem;
        }
        
        .car-detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .car-detail-label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.2rem;
        }
        
        .car-detail-value {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--white);
        }
        
        .card-actions {
            display: flex;
            gap: 0.8rem;
        }
        
        .btn-small {
            flex: 1;
            padding: 0.6rem;
            font-size: 0.85rem;
            font-family: 'Righteous', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .btn-edit {
            background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%);
            color: var(--white);
        }
        
        .btn-delete {
            background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%);
            color: var(--white);
        }

        .btn-add {
            background: linear-gradient(135deg, #27AE60 0%, #229954 100%);
            color: var(--white);
        }
        
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 3rem;
            padding: 1.5rem 2rem;
            background: rgba(26, 26, 26, 0.4);
            margin: 2rem;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            flex-wrap: wrap;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            color: var(--speed-yellow);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .stat-label {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: rgba(255, 255, 255, 0.6);
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 3rem;
            }
            
            .collection-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Enhanced database with all CollectHW columns
        const SAMPLE_DATABASE = [
  {
    "id": "hw-1770432928129-0",
    "name": "'68 Plymouth Barracuda Formula S",
    "series": "Multipack Exclusive",
    "year": "2026",
    "color": "Blue Metalflake",
    "manufacturer": "Mattel",
    "category": "Multipack Exclusive",
    "imageUrl": "https://s3-us-west-2.amazonaws.com/images.collecthw.com/b04f3753-2252-494b-8271-cacd61e65c76_small.jpg",
    "notes": "Multi-pack Exclusive",
    "huntType": "mainline",
    "tampo": "White, black & red stripes, \"Plymouth\" \"Mopar\" logo",
    "wheelType": "5SP Gold",
    "toyNumber": "X6999",
    "exclusive": "Multi-pack Exclusive"
  },
  {
    "id": "hw-1770432928129-1",
    "name": "'98 Honda Prelude",
    "series": "Factory Fresh",
    "year": "2026",
    "color": "Black",
    "manufacturer": "Mattel",
    "category": "Factory Fresh",
    "imageUrl": "https://s3-us-west-2.amazonaws.com/images.collecthw.com/13f603b6-29e0-4095-b102-1d895a97f6fa_small.jpg",
    "notes": "Silver Red",
    "huntType": "mainline",
    "tampo": "Silver Red",
    "wheelType": "MC5",
    "caseLetter": "F"
  },
  {
    "id": "hw-1770432928129-2",
    "name": "'06 Pontiac GTO",
    "series": "Hot Wheels Silver Series - Pontiac 100th Anniversary",
    "year": "2026",
    "color": "Yellow",
    "manufacturer": "Mattel",
    "category": "Hot Wheels Silver Series - Pontiac 100th Anniversary",
    "imageUrl": "https://s3-us-west-2.amazonaws.com/images.collecthw.com/e9e25c69-a0c4-4ca0-b16c-6c82552aa34d_small.png",
    "notes": "Detailed Headlights And Taillights",
    "huntType": "mainline",
    "tampo": "Detailed Headlights And Taillights",
    "wheelType": "MM5",
    "toyNumber": "JKY10-JA10",
    "assortmentNumber": "GRT01"
  },
  {
    "id": "hw-1770432928129-3",
    "name": "'07 Honda S2000",
    "series": "Mattel Brick Shop",
    "year": "2026",
    "color": "Yellow",
    "manufacturer": "Mattel",
    "category": "Mattel Brick Shop",
    "imageUrl": "https://s3-us-west-2.amazonaws.com/images.collecthw.com/f573d7f3-128a-4891-af69-b94372b3058d_small.jpg",
    "notes": "Included With '07 Honda S2000 Building Set, Honda S2000 On Base",
    "huntType": "mainline",
    "tampo": "Black Hood",
    "wheelType": "PR5",
    "exclusive": "Mattel Brick Shop"
  }
];
        
        function CarImageGallery({ images = [], currentImageIndex, onPrev, onNext }) {
            if (!images || images.length === 0) {
                return (
                    <div className="car-image-container">
                        <div style={{fontSize: '5rem', opacity: 0.3}}>üèéÔ∏è</div>
                    </div>
                );
            }

            const currentImage = images[currentImageIndex] || images[0];

            return (
                <div className="car-image-container">
                    <img src={currentImage} alt="Car" className="car-image" />
                    
                    {images.length > 1 && (
                        <>
                            <button className="image-nav prev" onClick={onPrev}>‚Äπ</button>
                            <button className="image-nav next" onClick={onNext}>‚Ä∫</button>
                            <div className="image-indicator">
                                {images.map((_, idx) => (
                                    <div 
                                        key={idx} 
                                        className={`image-indicator-dot ${idx === currentImageIndex ? 'active' : ''}`}
                                    />
                                ))}
                            </div>
                        </>
                    )}
                </div>
            );
        }
        
        function App() {
            const [activeTab, setActiveTab] = useState('collection');
            const [ownedCars, setOwnedCars] = useState([]);
            const [formData, setFormData] = useState({
                name: '',
                series: '',
                year: '',
                color: '',
                manufacturer: '',
                notes: '',
                category: '',
                images: [],
                mainImageIndex: 0,
                borderColor: '#FF4500',
                huntType: 'mainline',
                // New CollectHW fields
                colNumber: '',
                seriesNumber: '',
                tampo: '',
                wheelType: '',
                toyNumber: '',
                assortmentNumber: '',
                caseLetter: '',
                exclusive: '',
                value: ''
            });
            const [searchTerm, setSearchTerm] = useState('');
            const [filterSeries, setFilterSeries] = useState('');
            const [filterCategory, setFilterCategory] = useState('');
            const [filterHuntType, setFilterHuntType] = useState('');
            const [editingId, setEditingId] = useState(null);
            const [showOnlyOwned, setShowOnlyOwned] = useState(false);
            const [imageIndexes, setImageIndexes] = useState({});
            
            useEffect(() => {
                const savedCars = localStorage.getItem('hotwheelsOwnedCars');
                if (savedCars) {
                    setOwnedCars(JSON.parse(savedCars));
                }
            }, []);
            
            useEffect(() => {
                localStorage.setItem('hotwheelsOwnedCars', JSON.stringify(ownedCars));
            }, [ownedCars]);
            
            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({
                    ...prev,
                    [name]: value
                }));
            };
            
            const handleImageChange = (e) => {
                const files = Array.from(e.target.files);
                
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setFormData(prev => ({
                            ...prev,
                            images: [...prev.images, reader.result]
                        }));
                    };
                    reader.readAsDataURL(file);
                });
            };

            const removeImage = (index) => {
                setFormData(prev => ({
                    ...prev,
                    images: prev.images.filter((_, i) => i !== index),
                    mainImageIndex: prev.mainImageIndex >= prev.images.length - 1 ? 0 : prev.mainImageIndex
                }));
            };

            const setMainImage = (index) => {
                setFormData(prev => ({
                    ...prev,
                    mainImageIndex: index
                }));
            };
            
            const handleSubmit = (e) => {
                e.preventDefault();
                
                if (!formData.name) {
                    alert('Please enter a car name!');
                    return;
                }
                
                if (editingId !== null) {
                    setOwnedCars(prev => prev.map(car => 
                        car.id === editingId 
                            ? { ...formData, id: editingId }
                            : car
                    ));
                    setEditingId(null);
                } else {
                    const newCar = {
                        ...formData,
                        id: 'user-' + Date.now(),
                        isCustom: true
                    };
                    setOwnedCars(prev => [...prev, newCar]);
                }
                
                resetForm();
            };

            const resetForm = () => {
                setFormData({
                    name: '',
                    series: '',
                    year: '',
                    color: '',
                    manufacturer: '',
                    notes: '',
                    category: '',
                    images: [],
                    mainImageIndex: 0,
                    borderColor: '#FF4500',
                    huntType: 'mainline',
                    colNumber: '',
                    seriesNumber: '',
                    tampo: '',
                    wheelType: '',
                    toyNumber: '',
                    assortmentNumber: '',
                    caseLetter: '',
                    exclusive: '',
                    value: ''
                });
            };
            
            const handleEdit = (car) => {
                setFormData({
                    name: car.name,
                    series: car.series || '',
                    year: car.year || '',
                    color: car.color || '',
                    manufacturer: car.manufacturer || '',
                    notes: car.notes || '',
                    category: car.category || '',
                    images: car.images || (car.image || car.imageUrl ? [car.image || car.imageUrl] : []),
                    mainImageIndex: car.mainImageIndex || 0,
                    borderColor: car.borderColor || '#FF4500',
                    huntType: car.huntType || 'mainline',
                    colNumber: car.colNumber || '',
                    seriesNumber: car.seriesNumber || '',
                    tampo: car.tampo || '',
                    wheelType: car.wheelType || '',
                    toyNumber: car.toyNumber || '',
                    assortmentNumber: car.assortmentNumber || '',
                    caseLetter: car.caseLetter || '',
                    exclusive: car.exclusive || '',
                    value: car.value || ''
                });
                setEditingId(car.id);
                setActiveTab('add');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };
            
            const handleDelete = (id) => {
                if (window.confirm('Remove this car from your collection?')) {
                    setOwnedCars(prev => prev.filter(car => car.id !== id));
                }
            };

            const handleAddFromDatabase = (dbCar) => {
                const alreadyOwned = ownedCars.some(car => car.id === dbCar.id);
                if (alreadyOwned) {
                    alert('You already own this car!');
                    return;
                }

                const newCar = {
                    ...dbCar,
                    images: dbCar.imageUrl ? [dbCar.imageUrl] : [],
                    mainImageIndex: 0,
                    isCustom: false
                };
                setOwnedCars(prev => [...prev, newCar]);
            };
            
            const cancelEdit = () => {
                setEditingId(null);
                resetForm();
            };

            const isCarOwned = (carId) => {
                return ownedCars.some(car => car.id === carId);
            };

            const nextImage = (carId) => {
                setImageIndexes(prev => {
                    const car = [...ownedCars, ...SAMPLE_DATABASE].find(c => c.id === carId);
                    const images = car.images || (car.imageUrl ? [car.imageUrl] : []);
                    const currentIndex = prev[carId] || 0;
                    return {
                        ...prev,
                        [carId]: (currentIndex + 1) % images.length
                    };
                });
            };

            const prevImage = (carId) => {
                setImageIndexes(prev => {
                    const car = [...ownedCars, ...SAMPLE_DATABASE].find(c => c.id === carId);
                    const images = car.images || (car.imageUrl ? [car.imageUrl] : []);
                    const currentIndex = prev[carId] || 0;
                    return {
                        ...prev,
                        [carId]: currentIndex === 0 ? images.length - 1 : currentIndex - 1
                    };
                });
            };
            
            const filteredDatabaseCars = SAMPLE_DATABASE.filter(car => {
                const matchesSearch = car.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                    (car.series && car.series.toLowerCase().includes(searchTerm.toLowerCase()));
                const matchesSeries = !filterSeries || car.series === filterSeries;
                const matchesCategory = !filterCategory || car.category === filterCategory;
                const matchesHuntType = !filterHuntType || car.huntType === filterHuntType;
                const matchesOwned = !showOnlyOwned || isCarOwned(car.id);
                return matchesSearch && matchesSeries && matchesCategory && matchesHuntType && matchesOwned;
            });

            const filteredOwnedCars = ownedCars.filter(car => {
                const matchesSearch = car.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                    (car.series && car.series.toLowerCase().includes(searchTerm.toLowerCase()));
                const matchesSeries = !filterSeries || car.series === filterSeries;
                const matchesCategory = !filterCategory || car.category === filterCategory;
                const matchesHuntType = !filterHuntType || car.huntType === filterHuntType;
                return matchesSearch && matchesSeries && matchesCategory && matchesHuntType;
            });
            
            const allCars = [...SAMPLE_DATABASE, ...ownedCars.filter(car => car.isCustom)];
            const uniqueSeries = [...new Set(allCars.map(car => car.series).filter(Boolean))];
            const uniqueCategories = [...new Set(allCars.map(car => car.category).filter(Boolean))];
            
            const renderCarCard = (car, isOwned = false, showActions = true) => {
                const carImages = car.images || (car.imageUrl ? [car.imageUrl] : []);
                const currentIndex = imageIndexes[car.id] || car.mainImageIndex || 0;
                
                // MODIFIED: Use borderColor for card background instead of just border
                const borderColor = car.borderColor || '#FF4500';
                
                // Convert hex to rgba with transparency for background
                const hexToRgba = (hex, alpha = 0.15) => {
                    const r = parseInt(hex.slice(1, 3), 16);
                    const g = parseInt(hex.slice(3, 5), 16);
                    const b = parseInt(hex.slice(5, 7), 16);
                    return `rgba(${r}, ${g}, ${b}, ${alpha})`;
                };

                return (
                    <div 
                        key={car.id} 
                        className="car-card"
                        style={{
                            background: `linear-gradient(135deg, ${hexToRgba(borderColor, 0.2)} 0%, ${hexToRgba(borderColor, 0.05)} 100%)`,
                            borderColor: borderColor
                        }}
                    >
                        {car.huntType && (
                            <div className={`treasure-hunt-badge ${car.huntType}`}>
                                {car.huntType === 'mainline' ? 'MAINLINE' : car.huntType === 'th' ? 'T-HUNT' : 'SUPER TH'}
                            </div>
                        )}
                        {isOwned && <div className="owned-badge">OWNED</div>}
                        
                        <CarImageGallery 
                            images={carImages}
                            currentImageIndex={currentIndex}
                            onPrev={(e) => { e.stopPropagation(); prevImage(car.id); }}
                            onNext={(e) => { e.stopPropagation(); nextImage(car.id); }}
                        />
                        
                        <div className="car-info">
                            <h3 className="car-name">{car.name}</h3>
                            {car.series && <div className="car-series">{car.series}</div>}
                            
                            <div className="car-details">
                                {car.year && (
                                    <div className="car-detail-item">
                                        <span className="car-detail-label">Year</span>
                                        <span className="car-detail-value">{car.year}</span>
                                    </div>
                                )}
                                {car.color && (
                                    <div className="car-detail-item">
                                        <span className="car-detail-label">Color</span>
                                        <span className="car-detail-value">{car.color}</span>
                                    </div>
                                )}
                                {car.wheelType && (
                                    <div className="car-detail-item">
                                        <span className="car-detail-label">Wheels</span>
                                        <span className="car-detail-value">{car.wheelType}</span>
                                    </div>
                                )}
                                {car.toyNumber && (
                                    <div className="car-detail-item">
                                        <span className="car-detail-label">Toy #</span>
                                        <span className="car-detail-value">{car.toyNumber}</span>
                                    </div>
                                )}
                                {car.caseLetter && (
                                    <div className="car-detail-item">
                                        <span className="car-detail-label">Case</span>
                                        <span className="car-detail-value">{car.caseLetter}</span>
                                    </div>
                                )}
                                {car.exclusive && (
                                    <div className="car-detail-item">
                                        <span className="car-detail-label">Exclusive</span>
                                        <span className="car-detail-value">{car.exclusive}</span>
                                    </div>
                                )}
                            </div>
                            
                            {car.notes && (
                                <div style={{fontSize: '0.9rem', color: 'rgba(255, 255, 255, 0.7)', marginBottom: '1rem', fontStyle: 'italic'}}>
                                    {car.notes}
                                </div>
                            )}
                            
                            {showActions && (
                                <div className="card-actions">
                                    {isOwned ? (
                                        <>
                                            <button className="btn-small btn-edit" onClick={() => handleEdit(car)}>Edit</button>
                                            <button className="btn-small btn-delete" onClick={() => handleDelete(car.id)}>Remove</button>
                                        </>
                                    ) : (
                                        <button className="btn-small btn-add" onClick={() => handleAddFromDatabase(car)}>Add to Collection</button>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            return (
                <div className="app-container">
                    <header>
                        <h1>üèÅ Hot Wheels Collection üèÅ</h1>
                        <div className="tagline">Enhanced Edition</div>
                    </header>
                    
                    <div className="stats-bar">
                        <div className="stat-item">
                            <div className="stat-value">{ownedCars.length}</div>
                            <div className="stat-label">Cars Owned</div>
                        </div>
                        <div className="stat-item">
                            <div className="stat-value">{SAMPLE_DATABASE.length}</div>
                            <div className="stat-label">Database Cars</div>
                        </div>
                        <div className="stat-item">
                            <div className="stat-value">{uniqueSeries.length}</div>
                            <div className="stat-label">Series</div>
                        </div>
                        <div className="stat-item">
                            <div className="stat-value">{ownedCars.filter(c => c.huntType === 'sth').length}</div>
                            <div className="stat-label">Super TH</div>
                        </div>
                    </div>

                    <div className="tab-navigation">
                        <button 
                            className={`tab-button ${activeTab === 'collection' ? 'active' : ''}`}
                            onClick={() => setActiveTab('collection')}
                        >
                            My Collection
                        </button>
                        <button 
                            className={`tab-button ${activeTab === 'database' ? 'active' : ''}`}
                            onClick={() => setActiveTab('database')}
                        >
                            Browse Database
                        </button>
                        <button 
                            className={`tab-button ${activeTab === 'add' ? 'active' : ''}`}
                            onClick={() => setActiveTab('add')}
                        >
                            Add Custom Car
                        </button>
                    </div>

                    {activeTab === 'add' && (
                        <div className="section-container">
                            <h2 style={{fontFamily: "'Righteous', sans-serif", fontSize: '2rem', marginBottom: '1.5rem', color: 'var(--speed-yellow)'}}>
                                {editingId !== null ? '‚úèÔ∏è Edit Car' : '‚ûï Add Custom Car'}
                            </h2>
                            
                            <form onSubmit={handleSubmit}>
                                <div className="form-grid">
                                    <div className="form-group">
                                        <label>Car Name *</label>
                                        <input 
                                            type="text" 
                                            name="name"
                                            value={formData.name}
                                            onChange={handleInputChange}
                                            placeholder="e.g., '69 Dodge Charger"
                                            required
                                        />
                                    </div>
                                    
                                    <div className="form-group">
                                        <label>Series</label>
                                        <input 
                                            type="text" 
                                            name="series"
                                            value={formData.series}
                                            onChange={handleInputChange}
                                            placeholder="e.g., HW Speed Graphics"
                                        />
                                    </div>
                                    
                                    <div className="form-group">
                                        <label>Year</label>
                                        <input 
                                            type="text" 
                                            name="year"
                                            value={formData.year}
                                            onChange={handleInputChange}
                                            placeholder="e.g., 2024"
                                        />
                                    </div>
                                    
                                    <div className="form-group">
                                        <label>Color</label>
                                        <input 
                                            type="text" 
                                            name="color"
                                            value={formData.color}
                                            onChange={handleInputChange}
                                            placeholder="e.g., Orange"
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label>Hunt Type</label>
                                        <select 
                                            name="huntType"
                                            value={formData.huntType}
                                            onChange={handleInputChange}
                                        >
                                            <option value="mainline">Mainline</option>
                                            <option value="th">Treasure Hunt</option>
                                            <option value="sth">Super Treasure Hunt</option>
                                        </select>
                                    </div>

                                    <div className="form-group">
                                        <label>Card Color</label>
                                        <input 
                                            type="color" 
                                            name="borderColor"
                                            value={formData.borderColor}
                                            onChange={handleInputChange}
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label>Wheel Type</label>
                                        <input 
                                            type="text" 
                                            name="wheelType"
                                            value={formData.wheelType}
                                            onChange={handleInputChange}
                                            placeholder="e.g., 5SP, MC5"
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label>Toy Number</label>
                                        <input 
                                            type="text" 
                                            name="toyNumber"
                                            value={formData.toyNumber}
                                            onChange={handleInputChange}
                                            placeholder="e.g., X6999"
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label>Case Letter</label>
                                        <input 
                                            type="text" 
                                            name="caseLetter"
                                            value={formData.caseLetter}
                                            onChange={handleInputChange}
                                            placeholder="e.g., A, B, C"
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label>Assortment #</label>
                                        <input 
                                            type="text" 
                                            name="assortmentNumber"
                                            value={formData.assortmentNumber}
                                            onChange={handleInputChange}
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label>Exclusive</label>
                                        <input 
                                            type="text" 
                                            name="exclusive"
                                            value={formData.exclusive}
                                            onChange={handleInputChange}
                                            placeholder="e.g., Walmart Exclusive"
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label>Value</label>
                                        <input 
                                            type="text" 
                                            name="value"
                                            value={formData.value}
                                            onChange={handleInputChange}
                                            placeholder="e.g., $5.00"
                                        />
                                    </div>
                                </div>
                                
                                <div className="form-group" style={{marginBottom: '1.5rem'}}>
                                    <label>Tampo / Details</label>
                                    <textarea 
                                        name="tampo"
                                        value={formData.tampo}
                                        onChange={handleInputChange}
                                        placeholder="Graphics, decorations, special details..."
                                    />
                                </div>

                                <div className="form-group" style={{marginBottom: '1.5rem'}}>
                                    <label>Notes</label>
                                    <textarea 
                                        name="notes"
                                        value={formData.notes}
                                        onChange={handleInputChange}
                                        placeholder="Any additional notes..."
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label>Car Images (Multiple)</label>
                                    <div className="image-upload-multi">
                                        <input 
                                            type="file" 
                                            accept="image/*"
                                            multiple
                                            onChange={handleImageChange}
                                            style={{position: 'absolute', opacity: 0, pointerEvents: 'none'}}
                                            id="image-upload"
                                        />
                                        <label htmlFor="image-upload" style={{cursor: 'pointer', display: 'block'}}>
                                            <div style={{fontSize: '3rem', marginBottom: '0.5rem'}}>üì∏</div>
                                            <div>Click to upload images (multiple allowed)</div>
                                        </label>
                                    </div>

                                    {formData.images.length > 0 && (
                                        <div className="image-gallery">
                                            {formData.images.map((img, idx) => (
                                                <div 
                                                    key={idx} 
                                                    className={`image-gallery-item ${idx === formData.mainImageIndex ? 'main-image' : ''}`}
                                                    onClick={() => setMainImage(idx)}
                                                >
                                                    <img src={img} alt={`Car ${idx + 1}`} />
                                                    <button 
                                                        type="button"
                                                        className="remove-image"
                                                        onClick={(e) => { e.stopPropagation(); removeImage(idx); }}
                                                    >
                                                        √ó
                                                    </button>
                                                    {idx === formData.mainImageIndex && (
                                                        <div className="main-badge">MAIN</div>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                                
                                <div style={{display: 'flex', gap: '1rem', marginTop: '1.5rem'}}>
                                    <button type="submit" className="btn">
                                        <span>{editingId !== null ? 'Update Car' : 'Add to Collection'}</span>
                                    </button>
                                    {editingId !== null && (
                                        <button 
                                            type="button" 
                                            className="btn" 
                                            onClick={cancelEdit}
                                            style={{background: 'linear-gradient(135deg, #666 0%, #444 100%)'}}
                                        >
                                            <span>Cancel</span>
                                        </button>
                                    )}
                                </div>
                            </form>
                        </div>
                    )}

                    {(activeTab === 'collection' || activeTab === 'database') && (
                        <>
                            <div className="search-filter-section">
                                <div className="search-bar">
                                    <input 
                                        type="text"
                                        placeholder="üîç Search cars..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                    />
                                    <select 
                                        value={filterSeries}
                                        onChange={(e) => setFilterSeries(e.target.value)}
                                    >
                                        <option value="">All Series</option>
                                        {uniqueSeries.map(series => (
                                            <option key={series} value={series}>{series}</option>
                                        ))}
                                    </select>
                                    <select 
                                        value={filterHuntType}
                                        onChange={(e) => setFilterHuntType(e.target.value)}
                                    >
                                        <option value="">All Types</option>
                                        <option value="mainline">Mainline</option>
                                        <option value="th">Treasure Hunt</option>
                                        <option value="sth">Super TH</option>
                                    </select>
                                </div>
                            </div>
                            
                            {activeTab === 'collection' && (
                                filteredOwnedCars.length === 0 ? (
                                    <div style={{textAlign: 'center', padding: '4rem 2rem', color: 'rgba(255, 255, 255, 0.5)'}}>
                                        <div style={{fontSize: '4rem', marginBottom: '1rem', opacity: 0.3}}>üèéÔ∏è</div>
                                        <h2 style={{fontFamily: "'Righteous', sans-serif", fontSize: '1.8rem', marginBottom: '0.5rem'}}>
                                            {ownedCars.length === 0 ? 'No Cars Yet!' : 'No Matching Cars'}
                                        </h2>
                                        <p>{ownedCars.length === 0 ? 'Browse the database or add custom cars!' : 'Try adjusting filters.'}</p>
                                    </div>
                                ) : (
                                    <div className="collection-grid">
                                        {filteredOwnedCars.map(car => renderCarCard(car, true))}
                                    </div>
                                )
                            )}

                            {activeTab === 'database' && (
                                <div className="collection-grid">
                                    {filteredDatabaseCars.map(car => renderCarCard(car, isCarOwned(car.id), true))}
                                </div>
                            )}
                        </>
                    )}
                </div>
            );
        }
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js');
        }
    </script>
</body>
</html>
